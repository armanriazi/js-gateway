<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Intoductory - API-Gateway(A.R)</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="AboutMe.html"><strong aria-hidden="true">1.</strong> AboutMe</a></li><li class="chapter-item expanded "><a href="INTRO.html" class="active"><strong aria-hidden="true">2.</strong> Intoductory</a></li><li class="chapter-item expanded "><a href="configuration/docker/DOCKER.html"><strong aria-hidden="true">3.</strong> Docker_Setting</a></li><li class="chapter-item expanded "><a href="configuration/rabbitmq/RABBITMQ.html"><strong aria-hidden="true">4.</strong> RabbitMQ_Setting</a></li><li class="chapter-item expanded "><a href="diagram/DIAGRAM.html"><strong aria-hidden="true">5.</strong> Diagrams</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/Chart.html"><strong aria-hidden="true">5.1.</strong> Main Flowchar</a></li><li class="chapter-item "><a href="diagram/apis/APIs.html"><strong aria-hidden="true">5.2.</strong> How to use APIs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/apis/Call_GW_APIs.html"><strong aria-hidden="true">5.2.1.</strong> How to use Gateway_1</a></li><li class="chapter-item "><a href="diagram/apis/Call_GW_APIs_2.html"><strong aria-hidden="true">5.2.2.</strong> How to use Gateway 2</a></li></ol></li><li class="chapter-item "><a href="diagram/er/ER.html"><strong aria-hidden="true">5.3.</strong> ER</a></li><li class="chapter-item "><a href="diagram/class/CLASS.html"><strong aria-hidden="true">5.4.</strong> Class</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/class/Class_Diagram_Auth.html"><strong aria-hidden="true">5.4.1.</strong> Auth</a></li><li class="chapter-item "><a href="diagram/class/Class_Diagram_Controller.html"><strong aria-hidden="true">5.4.2.</strong> Controller</a></li><li class="chapter-item "><a href="diagram/class/Class_Diagram_Service.html"><strong aria-hidden="true">5.4.3.</strong> Service</a></li></ol></li><li class="chapter-item "><a href="diagram/flowchart/FLOWCHART.html"><strong aria-hidden="true">5.5.</strong> Flowchart</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/flowchart/Flowchart_User.html"><strong aria-hidden="true">5.5.1.</strong> User</a></li></ol></li><li class="chapter-item "><a href="diagram/sequential/SEQUENTIAL.html"><strong aria-hidden="true">5.6.</strong> Seuential</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/Sequential_Diagram_Auth.html"><strong aria-hidden="true">5.6.1.</strong> aiServices_ctrl</a></li><li class="chapter-item "><a href="diagram/Sequential_Diagram_Auth_noted.html"><strong aria-hidden="true">5.6.2.</strong> aiServices_ctr_notedl</a></li><li class="chapter-item "><a href="diagram/sequential/Sequential_Diagram_Auth.html"><strong aria-hidden="true">5.6.3.</strong> Auth</a></li></ol></li><li class="chapter-item "><a href="diagram/activity/ACTIVITY.html"><strong aria-hidden="true">5.7.</strong> Activity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_ctrl.html"><strong aria-hidden="true">5.7.1.</strong> aiServices_ctrl</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_srv.html"><strong aria-hidden="true">5.7.2.</strong> aiServices_srv</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_Logs.html"><strong aria-hidden="true">5.7.3.</strong> logs</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_ctrl.html"><strong aria-hidden="true">5.7.4.</strong> aiServices controller</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_srv.html"><strong aria-hidden="true">5.7.5.</strong> aiServices service</a></li><li class="chapter-item "><a href="service/aiServices_srv_naming.html"><strong aria-hidden="true">5.7.6.</strong> aiServices serviceNaming</a></li><li class="chapter-item "><a href="service/aiServices_srv_type.html"><strong aria-hidden="true">5.7.7.</strong> Type of service</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_ctrl_noted.html"><strong aria-hidden="true">5.7.8.</strong> aiServices_ctrl_noted</a></li><li class="chapter-item "><a href="diagram/activity/Activity_Diagram_aiServices_srv_noted.html"><strong aria-hidden="true">5.7.9.</strong> aiServices_srv_noted</a></li><li class="chapter-item "><a href="diagram/Activity_Diagram_Logs_notes.html"><strong aria-hidden="true">5.7.10.</strong> logs_noted</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="logs/logs.html"><strong aria-hidden="true">6.</strong> Logs</a></li><li class="chapter-item expanded "><a href="ClientCode.html"><strong aria-hidden="true">7.</strong> Codes</a></li><li class="chapter-item expanded "><a href="analyze/ANALYZE.html"><strong aria-hidden="true">8.</strong> Analysis</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="analyze/Stress_1.html"><strong aria-hidden="true">8.1.</strong> Stress(1)</a></li><li class="chapter-item "><a href="analyze/Stress_2.html"><strong aria-hidden="true">8.2.</strong> Stress(2)</a></li></ol></li><li class="chapter-item expanded "><a href="GLOSSARY.html"><strong aria-hidden="true">9.</strong> Glossery</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">API-Gateway(A.R)</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/armanriazi/js-gateway/tree/main/workspace" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/armanriazi/js-gateway/edit/main/workspace/./workspace//INTRO.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="api-gateway"><a class="header" href="#api-gateway">API-Gateway</a></h1>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<p>Based on below image, instead of AI services can be every kind of Service or API on your desire business logic like: carbon market, cloud services, bank, or feeds and etc,.</p>
<p>The significant feature of the Gateway is no vendor lock-in and for looking at another features please keep going and go through, you will find it.</p>
<p><img src="./assets/images/architecture.png" alt="image" /></p>
<p><img src="./assets/images/process-diagram.png" alt="Process Diagram" /></p>
<h2 id="initialization"><a class="header" href="#initialization">Initialization</a></h2>
<h2 id="packagejson"><a class="header" href="#packagejson">Package.json</a></h2>
<p>During the initial package installation, be sure to use <code>npm</code> to carry out the installation process and strictly avoid using pnpm, as it will lead to several errors. However, it is possible that after installing with npm, you can execute the work and run scripts using pnpm. Therefore, in this section, several suitable commands have been provided for use, especially one of the most important ones is <code>pnpm:clean</code>.</p>
<pre><code class="language-bash">    &quot;pnpm:version&quot;: &quot;pnpm --version&quot;,
    &quot;pnpm:yourpackage&quot;: &quot;pnpm view yourpackage versions&quot;,
    &quot;pnpm:clean&quot;: &quot;find ./ -name node_modules -type d -exec rm -rf {} +&quot;,
    &quot;pnpm:update&quot;: &quot;pnpm -r update -i -L&quot;,
    &quot;pnpm:dedupe&quot;: &quot;pnpm dedupe --check&quot;,
    &quot;pnpm:check&quot;: &quot;pnpm run lint:md &amp;&amp; pnpm run lint:fix &amp;&amp; pnpm run compile&quot;,
    &quot;pnpm:dev&quot;: &quot;nodemon src/index.js&quot;,
    &quot;deps&quot;: &quot;pnpm update -i --latest -r&quot;,
    &quot;pnpm:start&quot;: &quot;pnpm run build:live&quot;,
    &quot;debug&quot;: &quot;DEBUG=http,express:*,app:* nodemon index.js&quot;,
    &quot;node:dev&quot;: &quot;cross-env NODE_ENV=development node -r esm ./src/index&quot;,
    &quot;node:inspect&quot;: &quot;cross-env NODE_ENV=development &amp;&amp; cross-env NODE_INSPECT_RESUME_ON_START=1 node inspect ./src/modules/users/users.controller.js&quot;,
    &quot;node:inspect:9223&quot;: &quot;cross-env NODE_ENV=development &amp;&amp; cross-env NODE_INSPECT_RESUME_ON_START=1 node --inspect=9223 ./src/modules/users/users.controller.js&quot;    
</code></pre>
<h2 id="docker"><a class="header" href="#docker">Docker</a></h2>
<p>Occocionally, To set the correct time for the time_log variable in Docker, which sometimes can be problematic, you can use the following command inside your Dockerfile:</p>
<p><code>RUN echo &quot;date '+%Y-%m-%d %H:%M:%S'&quot; &gt; /etc/timezone</code></p>
<p>This command will set the system’s timezone to match the local timezone, which should help with populating the time_log variable correctly. Remember to replace the timezone format and value according to your specific needs.</p>
<blockquote>
<p><code>ENV TZ=&quot;Asia/Tehran&quot;</code></p>
</blockquote>
<h2 id="expressjs"><a class="header" href="#expressjs">ExpressJS</a></h2>
<p>The two main objects, namely request and response, undergo changes throughout all sections of the program. Therefore, paying attention to the components of this section can be helpful to you.</p>
<h3 id="request"><a class="header" href="#request">Request</a></h3>
<p>Includes:</p>
<pre><code class="language-json">{
    &quot;req&quot; :  {
        &quot;body&quot;: {
            &quot;type&quot;: {},
            &quot;userId&quot;: {},
            &quot;occlusion&quot;: {},
        },
        &quot;headers&quot;: {},
        &quot;originalUrl&quot;: {},
        &quot;method&quot; : {
            &quot;get&quot;: {},
            &quot;post&quot;: {},
        },        
        &quot;requestType&quot; : {},
        &quot;srtProxy&quot; : {},        
        &quot;projectName&quot;: {},
        &quot;accessAiService&quot;: {
            &quot;Service&quot; : {
                &quot;host&quot;: {},
                &quot;protocol&quot;: {},
                &quot;rejectUnauthorized&quot;: {},
            }
        },
        &quot;serviceName&quot; : {},
        &quot;path&quot;: {},
        &quot;hasFile&quot; : {},
        &quot;filePath&quot; : {},
        &quot;file&quot;: {
            &quot;howGet&quot; : {},
        },
        &quot;files&quot;: {},
        &quot;ip&quot;: {},
        &quot;query&quot;: {},
        &quot;params&quot;: {},
        &quot;user&quot;: {},        
        &quot;clause&quot;: {},
        &quot;isAllowedIP&quot; : {},
        &quot;gatewayLogData&quot;:{},
    }
}
</code></pre>
<h3 id="response"><a class="header" href="#response">Response</a></h3>
<pre><code class="language-json">{
    &quot;res&quot;: {
        &quot;locals&quot;: {},
        &quot;requestId&quot; : {},
        &quot;sendFile&quot;: {},
        &quot;json&quot;: {},
        &quot;data&quot;: {
            &quot;status&quot;:{},
            &quot;message&quot;: {
                &quot;data&quot; : {}
            }
       },
    }
}
</code></pre>
<h2 id="structure-of-log"><a class="header" href="#structure-of-log">Structure of log</a></h2>
<pre><code class="language-json">{
    &quot;log&quot; : {
       &quot;requestId&quot;:{},
        &quot;meta&quot;: {
          &quot;userAgent&quot;: {},
          &quot;ip&quot;: {},
          &quot;method&quot;: {},
          &quot;originalUrl&quot;: {},
          &quot;path&quot;: {},
        },
        &quot;data&quot;: {
          &quot;status&quot; : {},
          &quot;message&quot; : {},
          &quot;request&quot; : {},
          &quot;response&quot; : {},
        },
    }
}
</code></pre>
<h2 id="db"><a class="header" href="#db">DB</a></h2>
<h3 id="relations"><a class="header" href="#relations">Relations</a></h3>
<h4 id="cascades"><a class="header" href="#cascades">Cascades</a></h4>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
If a ApiKey remove from ApiKeys then {only remove related records in the Apis}</li>
<li><input disabled="" type="checkbox" checked=""/>
If a Service remove from Services then {only remove related records in the Apis}</li>
<li><input disabled="" type="checkbox" checked=""/>
If a Project remove from Projects then {only remove related records in the Services}</li>
<li><input disabled="" type="checkbox" checked=""/>
If a User remove from Users then {only remove related records in the ApiKeys and Apis}</li>
<li><input disabled="" type="checkbox" checked=""/>
If a Api remove from Apis then will not affect on any tables.</li>
</ul>
<h2 id="rabbitmq"><a class="header" href="#rabbitmq">RabbitMq</a></h2>
<p>By executing the list command, you can see a list of installed plugins. Keep in mind that due to the use of the amqplib library, the program currently does not require the installation of plugin version 1. However, if a need arises on the Rabbit tool side, it is better to activate the desired plugin based on your own needs.</p>
<p>‍<code>amqplib</code></p>
<blockquote>
<p>A library for making AMQP 0-9-1 clients for Node.JS, and an AMQP 0-9-1 client for Node.JS v10+. This library does not implement AMQP 1.0 or AMQP 0-10.</p>
</blockquote>
<pre><code class="language-bash">rabbitmq-plugins list
Listing plugins with pattern &quot;.*&quot; ...
 Configured: E = explicitly enabled; e = implicitly enabled
 | Status: * = running on rabbit@451f4ab695e9
 |/
[E*] rabbitmq_amqp1_0                  3.13.1
[  ] rabbitmq_auth_backend_cache        (pending upgrade to 3.13.1)
[  ] rabbitmq_auth_backend_http         (pending upgrade to 3.13.1)
[  ] rabbitmq_auth_backend_ldap         (pending upgrade to 3.13.1)
[  ] rabbitmq_auth_backend_oauth2       (pending upgrade to 3.13.1)
[  ] rabbitmq_auth_mechanism_ssl        (pending upgrade to 3.13.1)
[  ] rabbitmq_consistent_hash_exchange  (pending upgrade to 3.13.1)
[E*] rabbitmq_event_exchange           3.13.1
[e*] rabbitmq_federation               3.13.1
[  ] rabbitmq_federation_management     (pending upgrade to 3.13.1)
[  ] rabbitmq_jms_topic_exchange        (pending upgrade to 3.13.1)
[E*] rabbitmq_management               3.13.1
[e*] rabbitmq_management_agent         3.13.1
[  ] rabbitmq_mqtt                      (pending upgrade to 3.13.1)
[  ] rabbitmq_peer_discovery_aws        (pending upgrade to 3.13.1)
[  ] rabbitmq_peer_discovery_common     (pending upgrade to 3.13.1)
[  ] rabbitmq_peer_discovery_consul     (pending upgrade to 3.13.1)
[  ] rabbitmq_peer_discovery_etcd       (pending upgrade to 3.13.1)
[  ] rabbitmq_peer_discovery_k8s        (pending upgrade to 3.13.1)
[E*] rabbitmq_prometheus               3.13.1
[  ] rabbitmq_random_exchange           (pending upgrade to 3.13.1)
[  ] rabbitmq_recent_history_exchange   (pending upgrade to 3.13.1)
[  ] rabbitmq_sharding                  (pending upgrade to 3.13.1)
[  ] rabbitmq_shovel                    (pending upgrade to 3.13.1)
[  ] rabbitmq_shovel_management         (pending upgrade to 3.13.1)
[E*] rabbitmq_stomp                    3.13.1
[E*] rabbitmq_stream                   3.13.1
[  ] rabbitmq_stream_management         (pending upgrade to 3.13.1)
[  ] rabbitmq_top                       (pending upgrade to 3.13.1)
[E*] rabbitmq_tracing                  3.13.1
[  ] rabbitmq_trust_store               (pending upgrade to 3.13.1)
[e*] rabbitmq_web_dispatch             3.13.1
[  ] rabbitmq_web_mqtt                  (pending upgrade to 3.13.1)
[  ] rabbitmq_web_mqtt_examples         (pending upgrade to 3.13.1)
[  ] rabbitmq_web_stomp                 (pending upgrade to 3.13.1)
[  ] rabbitmq_web_stomp_examples        (pending upgrade to 3.13.1)
</code></pre>
<h3 id="relation-of-web-app-and-amqp"><a class="header" href="#relation-of-web-app-and-amqp">Relation of web-app and AMQP</a></h3>
<p>The project uses the AMQP protocol version 0-9-1 and has not utilized version one.</p>
<p>When you intend to use a service, first create a queue with the service’s name. Then, when you make a post request with the name of that service, you will see that the request will go to this queue. In the library present in the project, named broker, a random queue is created during initialization, and this is done by the program itself. Then, when sending an API request, the response is supposed to be received by the random queue and then sent to the main queue, which is named after the service. Note that if the message in the main queue is consumed, the API is deleted, and the execution of the program moves on to other codes. Therefore, if there is no consumption, the API remains in ‘sending’ status.
If you intend to track messages in RabbitMQ, it is best to follow the steps below.
In addition to the random queue created by our program, we have something called a tag, which is created by Rabbit as follows: This tag is actually related to the consumer of the random queue, and even if we have thousands of consumers from the queue, we will still have the same name format at the beginning of the tag.</p>
<p><code>amq.ctag-*</code></p>
<h4 id="policy"><a class="header" href="#policy">Policy</a></h4>
<ol>
<li>
<p>Create a durable queue as a name of your service</p>
</li>
<li>
<p>Create a new policy as  <code>amq.gen-*</code></p>
</li>
<li>
<p>Binding</p>
</li>
</ol>
<pre><code class="language-md">From exchange: amq.direct
Routing key: VisionQuestionAnswering
Arguments: correlation_id  or conversation_id 
// correlation_id/conversation_id(equal) are attributes of message
// if you use grafana you can only find conversation_id inthe section of search -&gt; net.peer.port
</code></pre>
<p>When a request is sent from the API, you can take action in the message reception section of the main queue, which is named after the service. You can, for example, view the relevant message in the following format.</p>
<pre><code class="language-md">the server reported 0 messages remaining.
Exchange (AMQP default)
Routing Key VisionQuestionAnswering
Redelivered ○
Properties 
reply_to: amq.gen-diLPs219ZPQ7rpZ5ewmAtQ
correlation_id: 4de512fe-c252-4456-9783-f7f820fd8875
headers: 
traceparent: 00-d4a5db06430b944a1081030e47b3ae28-e532db78b29aaa7d-01
Payload
126 bytes
Encoding: string
{&quot;imagePath&quot;:&quot;/home/armanriazi/gw-projects/gateway/gateway/assets/uploads/gateway-file-95233335-f649-44bd-be89-9b0c7a166472.png&quot;}
</code></pre>
<p>If you create a message for testing on the random queue with the mentioned ID, your program, which acts as the consumer of this queue, will enter the getMessageFromQueue method. However, if you publish a message in the main service queue, it will not go into your program, but you can see the messages inside this queue, unlike the random queue. The main reason is that your program is in the random queue state and consumes the published message, so you can no longer monitor it in the management UI section. But regarding the main queue named after your service, you are no longer a consumer, and you can view the message through the management section, where it may still be in the queue.</p>
<pre><code class="language-md">  traceId: '147280a3b91ebaf616adc777dd9152e4',
  parentId: undefined,
  traceState: undefined,
  name: 'amq.gen-3CrgyivK8a-NV6sz3DxhdQ process',
  id: '93cc7688d63127dd',
  kind: 4,
  timestamp: 1716273604511000,
  duration: 41770071.963,
  attributes: {
    'messaging.protocol_version': '0.9.1',
    'messaging.protocol': 'AMQP',
    'net.peer.name': '0.0.0.0',
    'net.peer.port': 5672,
    'messaging.system': 'rabbitmq',
    'messaging.destination': '',
    'messaging.destination_kind': 'topic',
    'messaging.rabbitmq.routing_key': 'amq.gen-3CrgyivK8a-NV6sz3DxhdQ',
    'messaging.operation': 'process',
    'messaging.conversation_id': '0b06889b-d952-43ec-b453-839c6c23b22c'
</code></pre>
<hr />
<ul>
<li><a href="https://www.armanriazi.github.io/messagebrokers">MDBook Message Brokers</a></li>
<li><a href="https://www.github.com/armanriazi/messagebrokers">GitHub Message Brokers</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="AboutMe.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="configuration/docker/DOCKER.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="AboutMe.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="configuration/docker/DOCKER.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
